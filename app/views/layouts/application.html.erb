<!DOCTYPE html>
<html>
<head>
  <title>Onetime</title>
  <%= stylesheet_link_tag    "application", :media => "all" %>
  <%= javascript_include_tag "application" %>
  <%= csrf_meta_tags %>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:300' rel='stylesheet' type='text/css'>
  <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyASm3CwaK9qtcZEWYa-iQwHaGi3gcosAJc&sensor=false">
  </script>
  
  <script type="text/javascript">

  var map;
    // When the window has finished loading create our google map below
    google.maps.event.addDomListener(window, 'load', init);

    function init() {
        var mapOptions = {
            zoom: 3,
            center: new google.maps.LatLng(40.6700, -73.9400),
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            styles: [
              {
                  featureType:'all',
                  stylers:[
                  {visibility:'off'}
                ]
              },
              {
                  featureType:'water',
                  stylers:[
                  {visibility:'on'},
                  {lightness:-100}
                  ]
              }
            ],
        };

        // Get the HTML DOM element that will contain your map 
        // We are using a div with id="map" seen below in the <body>
        var mapElement = document.getElementById('map');

        // Create the Google Map using out element and options defined above
        var map = new google.maps.Map(mapElement, mapOptions);


        $.ajax({
        url: '/stories',
        method: 'GET',
        dataType: 'json'
        }).done(function(data){
          $.each(data, function(idx, story){
            var coordinates = new google.maps.LatLng(story.latitude, story.longitude)
            console.log(story.content)
            var contentString = '<div id="marker-content">' + story.content.substring(0,20) + '</div>';
            var marker = new google.maps.Marker({
              position: coordinates,
              map: map,
              icon: 'assets/marker.png'
              });
            var infowindow = new google.maps.InfoWindow({
              content: contentString
            });

            var infoWindow = google.maps.event.addListener(marker, 'click', function() {
                map.setZoom(8);
                map.setCenter(marker.getPosition());
                content: contentString,
                infowindow.open(map,marker)
              });
            // var infoWindow = new google.maps.InfoWindow({
            //   content: contentString
            // });
            // google.maps.event.addListener(marker, 'click', function() {
            //   infoWindow.open(map,marker);
            // });
          });
        });
    };
  </script>
</head>
<body>

<div id="container">
  <div id="user_nav">
    <div id="signed-in-links">
      Logged in as <strong id="email"></strong>.
      <%= link_to 'Edit profile', edit_user_registration_path %> |
      <%= link_to "Logout", destroy_user_session_path, method: :delete %>
    </div> 
    <div id="welcome-links">   
        <%= link_to "Sign Up", new_user_registration_path, class: "d-link", id: "sign-up-link" %> |
        <%= link_to "Login", new_user_session_path, class: "d-link", id: "log-in-link"  %>
    </div>
  </div>

  <% flash.each do |name, msg| %>
    <%= content_tag :div, msg, id: "flash_#{name}" %>
  <% end %>

  

  <%= yield %>
</div>

<div id="map"></div>

<%= render :partial => "layouts/log_in" %>
<%= render :partial => "layouts/sign_up" %>

</body>
</html>
